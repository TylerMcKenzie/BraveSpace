this.kontra={init:function(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");if(!this._isCanvas(e))throw Error("You must provide a canvas element for the game");this.context=e.getContext("2d")},_noop:new Function,_isString:function(t){return""+t===t},_isNumber:function(t){return+t===t},_isFunc:function(t){return"function"==typeof t},_isImage:function(t){return!!t&&"IMG"===t.nodeName||this._isCanvas(t)},_isCanvas:function(t){return!!t&&"CANVAS"===t.nodeName}},function(t,e,i){t.gameLoop=function(s){function a(){if(n=e(a),o=i.now(),r=o-h,h=o,!(r>1e3)){for(p+=r;p>=l;)u.update(d),p-=l;x(),u.render()}}if(s=s||{},!t._isFunc(s.update)||!t._isFunc(s.render))throw Error("You must provide update() and render() functions");var h,n,o,r,c=s.fps||60,p=0,l=1e3/c,d=1/c,x=s.clearCanvas===!1?t._noop:function(){t.context.clearRect(0,0,t.canvas.width,t.canvas.height)},u={update:s.update,render:s.render,isStopped:!0,start:function(){h=i.now(),this.isStopped=!1,e(a)},stop:function(){this.isStopped=!0,cancelAnimationFrame(n)},_frame:a,set _last(t){h=t}};return u}}(kontra,requestAnimationFrame,performance),function(){function t(t){var e=h[t.which];a[e]=!0,s[e]&&s[e](t)}function e(t){var e=h[t.which];a[e]=!1}function i(t){a={}}for(var s={},a={},h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n=0;26>n;n++)h[65+n]=(10+n).toString(36);for(n=0;10>n;n++)h[48+n]=""+n,h[96+n]="numpad"+n;for(n=1;20>n;n++)h[111+n]="f"+n;var o=window.addEventListener;o("keydown",t),o("keyup",e),o("blur",i),kontra.keys={bind:function(t,e){t=Array.isArray(t)?t:[t];for(var i,a=0;i=t[a];a++)s[i]=e},unbind:function(t){t=Array.isArray(t)?t:[t];for(var e,i=0;e=t[i];i++)s[e]=null},pressed:function(t){return!!a[t]}}}(),function(t,e,i){t.vector=function(e,i){var s=Object.create(t.vector.prototype);return s._init(e,i),s},t.vector.prototype={_init:function(t,e){this._x=t||0,this._y=e||0},add:function(t,e){this._x+=(t.x||0)*(e||1),this._y+=(t.y||0)*(e||1)},clamp:function(t,e,s,a){this._clamp=!0,this._xMin=void 0!==t?t:-i,this._yMin=void 0!==e?e:-i,this._xMax=void 0!==s?s:i,this._yMax=void 0!==a?a:i},get x(){return this._x},get y(){return this._y},set x(t){this._x=this._clamp?e.min(e.max(this._xMin,t),this._xMax):t},set y(t){this._y=this._clamp?e.min(e.max(this._yMin,t),this._yMax):t}},t.sprite=function(e){var i=Object.create(t.sprite.prototype);return i.init(e),i},t.sprite.prototype={init:function(e){var i,s,a,h=this;e=e||{},h.position=h.position||t.vector(),h.velocity=h.velocity||t.vector(),h.acceleration=h.acceleration||t.vector(),h.position._init(e.x,e.y),h.velocity._init(e.dx,e.dy),h.acceleration._init(e.ddx,e.ddy),h.width=h.height=0;for(var n in e)h[n]=e[n];if(h.ttl=e.ttl||0,h.context=e.context||t.context,h.advance=h._advance,h.draw=h._draw,t._isImage(i=e.image))h.image=i,h.width=i.width,h.height=i.height,h.draw=h._drawImg;else if(i=e.animations){h.animations={};for(var o in i)s=i[o],h.animations[o]=s.clone?s.clone():s,a||(a=h.animations[o]);h.currentAnimation=a,h.width=a.width,h.height=a.height,h.advance=h._advanceAnim,h.draw=h._drawAnim}},get x(){return this.position.x},get y(){return this.position.y},get dx(){return this.velocity.x},get dy(){return this.velocity.y},get ddx(){return this.acceleration.x},get ddy(){return this.acceleration.y},set x(t){this.position.x=t},set y(t){this.position.y=t},set dx(t){this.velocity.x=t},set dy(t){this.velocity.y=t},set ddx(t){this.acceleration.x=t},set ddy(t){this.acceleration.y=t},isAlive:function(){return this.ttl>0},collidesWith:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y},update:function(t){this.advance(t)},render:function(){this.draw()},playAnimation:function(t){this.currentAnimation=this.animations[t]},_advance:function(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--},_advanceAnim:function(t){this._advance(t),this.currentAnimation.update(t)},_draw:function(){this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height)},_drawImg:function(){this.context.drawImage(this.image,this.x,this.y)},_drawAnim:function(){this.currentAnimation.render({context:this.context,x:this.x,y:this.y})}}}(kontra,Math,1/0),function(t){t.pool=function(e){e=e||{};var i,s=0,a=0;if(!t._isFunc(e.create)||!(i=e.create())||!(t._isFunc(i.update)&&t._isFunc(i.init)&&t._isFunc(i.isAlive)))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");return{create:e.create,objects:[i],size:1,maxSize:e.maxSize||1/0,get:function(t){if(t=t||{},this.objects[0].isAlive()){if(this.size===this.maxSize)return;for(var e=0;e<this.size&&this.objects.length<this.maxSize;e++)this.objects.unshift(this.create());this.size=this.objects.length,s=this.size-1}var i=this.objects[0];i.init(t);for(var h=1;h<this.size;h++)this.objects[h-1]=this.objects[h];this.objects[s]=i,a++},getAliveObjects:function(){return this.objects.slice(this.objects.length-a)},clear:function(){a=s=this.objects.length=0,this.size=1,this.objects.push(this.create())},update:function(t){for(var e,i=s,h=Math.max(this.objects.length-a,0);i>=h;)if(e=this.objects[i],e.update(t),e.isAlive())i--;else{for(var n=i;n>0;n--)this.objects[n]=this.objects[n-1];this.objects[0]=e,a--,h++}},render:function(){for(var t=Math.max(this.objects.length-a,0),e=s;e>=t;e--)this.objects[e].render&&this.objects[e].render()}}}}(kontra),kontra.init("gameCanvas"),kontra.canvas.width=window.innerWidth,kontra.canvas.height=window.innerHeight;var Game=window.Game=Game||{};Game.gameLoop=kontra.gameLoop,!function(){Game.Store={}}(),!function(){function t(t){this.init(t),this.text=this.text||"",this.px=this.px||"15px",this.fontFamily=this.fontFamily||"sans-serif",this.fillStyle=this.fillStyle||"white",this.strokeStyle=this.strokeStyle||"white",this.textAlign=this.textAlign||"start",this.isFixed===!1?this.isFixed=this.isFixed:this.isFixed=!0,this.isVisible=!0,"hidden"===t.visibility&&(this.isVisible=!1)}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.font=function(){var t=this.px+" "+this.fontFamily;return t},t.prototype.render=function(t,e){var t=t||0,e=e||0;this.context.save(),this.context.font=this.font(),this.context.fillStyle=this.fillStyle,this.context.strokeStyle=this.strokeStyle,this.context.textAlign=this.textAlign,this.context.fillText(this.text,this.x-t,this.y-e),this.context.restore()},t.prototype.update=function(){},t.prototype.show=function(){this.isVisible=!0},t.prototype.hide=function(){this.isVisible=!1},Game.Text=t}(),!function(){function t(){this.text=[]}function e(t){return t instanceof Game.Text?!0:!1}t.prototype.constructor=t,t.prototype.add=function(t){if(e(t))this.text.push(t);else{if("object"!=typeof t)throw new Error("TextManager requires a Game.TextBox object or object to add.");var i=new Game.Text(t);this.text.push(i)}},t.prototype.updateTexts=function(){for(var t=0;t<this.text.length;t++)this.text[t].isVisible&&this.text[t].update()},t.prototype.renderTexts=function(t,e){for(var i=0;i<this.text.length;i++)this.text[i].isVisible&&(this.text[i].isFixed?this.text[i].render():this.text[i].render(t,e))},Game.TextManager=t}(),!function(){function t(t){this.init(t),this.isFixed===!1?this.isFixed=this.isFixed:this.isFixed=!0,this.isVisible=!0,"hidden"===t.visibility&&(this.isVisible=!1),this.render=function(t,e){var t=t||0,e=e||0;this.drawFunc(t,e)}}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.contructor=t,t.prototype.show=function(){this.isVisible=!0},t.prototype.hide=function(){this.isVisible=!1},Game.Graphic=t}(),!function(){function t(){this.graphics=[]}function e(t){return t instanceof Game.Graphic?!0:!1}t.prototype.constructor=t,t.prototype.add=function(t){if(e(t))this.graphics.push(t);else{if("object"!=typeof t)throw new Error("Paramater was not Game.Graphic or graphic property object.");var i=new Game.Graphic(t);this.graphics.push(i)}},t.prototype.updateGraphics=function(){for(var t=0;t<this.graphics.length;t++)this.graphics[t].isVisible&&this.graphics[t].update()},t.prototype.renderGraphics=function(t,e){for(var i=0;i<this.graphics.length;i++)this.graphics[i].isVisible&&(this.graphics[i].isFixed?this.graphics[i].render():this.graphics[i].render(t,e))},Game.GraphicManager=t}(),!function(){function t(t,e){this.name=t,this.text=new Game.TextManager,this.graphics=new Game.GraphicManager;for(prop in e)("render"!==prop||"update"!==prop)&&(this[prop]=e[prop]);this.init&&this.init(),this.update=function(){e.update.call(this),this.text.updateTexts(),this.graphics.updateGraphics()},this.render=function(){e.render.call(this),this.camera?(this.text.renderTexts(this.camera.xView,this.camera.yView),this.graphics.renderGraphics(this.camera.xView,this.camera.yView)):(this.text.renderTexts(),this.graphics.renderGraphics())}}Game.State=t}(),!function(){function t(){this.states={},this._currentState=null}function e(t){return t instanceof Game.State?!0:!1}t.prototype.state=function(t,i){var s;s=e(t)?t:new Game.State(t,i),this.states[s.name]=s},t.prototype.setCurrentState=function(t){if(e(t))this._currentState=t;else{var i=this.states[t];if(!i)throw new Error("State not found.");this._currentState=i}},t.prototype.renderCurrentState=function(){this._currentState.render()},t.prototype.updateCurrentState=function(){this._currentState.update()},Game.StateManager=new t}(),!function(){function t(t){this.x=t.x||0,this.y=t.y||0,this.points=t.points||[]}t.prototype.hasPoint=function(t,e){for(var i=!1,s=0,a=this.points.length-1;s<this.points.length;s++){var h=this.points[s].x+this.x,n=this.points[a].x+this.x,o=this.points[s].y+this.y,r=this.points[a].y+this.y;o>e!=r>e&&(n-h)*(e-o)/(r-o)+h>t&&(i=!i),a=s}return i},t.prototype.rotate=function(t){for(var e=Game.Math.cos(t),i=Game.Math.sin(t),s=0;s<this.points.length;s++){var a=this.points[s].x,h=this.points[s].y,n=a*e-h*i,o=a*i+h*e;this.points[s]={x:n,y:o}}},t.prototype.scale=function(t){for(var e=0;e<this.points.length;e++){var i=this.points[e].x*t,s=this.points[e].y*t;this.points[e]={x:i,y:s}}},t.rotateMatrix=function(t,e){for(var i=Game.Math.cos(t),s=Game.Math.sin(t),a=0;a<e.length;a++){var h=e[a].x,n=e[a].y,o=h*i-n*s,r=h*s+n*i;e[a]={x:o,y:r}}return e},Game.Polygon=t}(),!function(){function t(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0,this.xMax=this.x+this.width,this.yMax=this.y+this.height}t.prototype.contructor=t,t.prototype.set=function(t,e,i,s){this.x=t,this.y=e,this.width=i||this.width,this.height=s||this.height,this.xMax=this.x+this.width,this.yMax=this.y+this.height},t.prototype.isWithinRect=function(t){return t.x<=this.x&&t.xMax>=this.xMax&&t.y<=this.y&&t.yMax>=this.yMax},t.prototype.overlapsRect=function(t){return this.x<t.xMax&&t.x<this.xMax&&this.y<t.yMax&&t.y<this.yMax},Game.Rectangle=t}(),!function(){var t={cos:function(t){var e=this.rad(t);return Math.cos(e)},sin:function(t){var e=this.rad(t);return Math.sin(e)},rad:function(t){return t*Math.PI/180},deg:function(t){return 180*t/Math.PI},random:function(t,e){return t&&!e?Math.random()*t:t&&e?Math.random()*(e-t)+t:Math.random()},distance:function(t,e){var i=e.x-t.x,s=e.y-t.y,a=Math.sqrt(i*i+s*s);return a},angleFrom:function(t,e){var i=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,i);return a*=180/Math.PI}};Game.Math=t}(),!function(){Game.Animator={animateTo:function(t,e,i,s){var a=performance.now(),h=t.x,n=t.y;requestAnimationFrame(function o(r){var c=(r-a)/s;c>1&&(c=1),t.x=h+c*e,t.y=n+c*i,1>c&&requestAnimationFrame(o)})}}}(),!function(){function t(t){var e=r[t.keyCode];a[e]=!1,n[e]=!1,h[e]&&h[e](t)}function e(t){var e=r[t.keyCode];a[e]=!0}function i(t){var e=r[t.keyCode];n[e]=!0,o[e]&&o[e](t)}Game.Controls={};for(var s=window.addEventListener,a={},h={},n={},o={},r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},c=0;26>c;c++)r[65+c]=(10+c).toString(36);for(var c=0;26>c;c++)r[97+c]=(10+c).toString(36);s("keyup",t),s("keydown",e),s("keypress",i),Game.Controls.keys={pressed:function(t){return!!a[t]},tapped:function(t){return!!n[t]},bind:function(t,e,i){switch(e){case"pressed":h[t]=i;break;case"tapped":o[t]=i}},unbind:function(t,e){switch(e){case"pressed":h[t]=null;break;case"tapped":o[t]=null}}}}(),!function(){function t(t,i,s,a,h,n){this.xView=t||0,this.yView=i||0,this.wView=s,this.hView=a,h&&n&&(this.worldW=h,this.worldW=n),this.xDeadZone=0,this.yDeadZone=0,this.axis=e.BOTH,this.followed=null,this.viewPort=new Game.Rectangle(this.xView,this.yView,this.wView,this.hView),this.worldW&&this.worldH&&(this.worldBounds=new Game.Rectangle(this.xView,this.yView,this.wView,this.hView,this.worldW,this.worldH))}var e={NONE:"none",HORIZONTAL:"horizontal",VERTICAL:"vertical",BOTH:"both"};t.prototype.constructor=t,t.prototype.follow=function(t,e,i){this.followed=t,this.xDeadZone=e||0,this.yDeadZone=i||0,this.update()},t.prototype.setWorldBounds=function(t,e){this.worldBounds.x=t,this.worldBounds.y=e},t.prototype.setAxis=function(t){t===e.HORIZONTAL?this.axis=e.HORIZONTAL:t===e.VERTICAL?this.axis=e.VERTICAL:t===e.BOTH?this.axis=e.BOTH:this.axis=e.NONE},t.prototype.update=function(){null!=this.followed&&((this.axis===e.HORIZONTAL||this.axis===e.BOTH)&&(this.followed.x-this.xView+this.xDeadZone>this.wView?this.xView=this.followed.x-(this.wView-this.xDeadZone):this.followed.x-this.xDeadZone<this.xView&&(this.xView=this.followed.x-this.xDeadZone)),(this.axis==e.VERTICAL||this.axis==e.BOTH)&&(this.followed.y-this.yView+this.yDeadZone>this.hView?this.yView=this.followed.y-(this.hView-this.yDeadZone):this.followed.y-this.yDeadZone<this.yView&&(this.yView=this.followed.y-this.yDeadZone)),this.viewPort.set(this.xView,this.yView),this.worldBounds&&(this.viewPort.withinRect(this.worldBounds)||(this.viewPort.x<this.worldBounds.x&&(this.xView=this.worldBounds.x),this.viewPort.y<this.worldBounds.y&&(this.yView=this.worldBounds.y),this.viewPort.xMax>this.worldBounds.xMax&&(this.xView=this.worldBounds.xMax-this.wView),this.viewPort.yMax>this.worldBounds.yMax&&(this.yView=this.worldBounds.yMax-this.hView))))},Game.Camera=t}(),!function(){function t(t){this.init(t),this.name=this.name||"",this.width=this.width||20,this.height=this.height||20,this.pickupRadius=2*this.width,this.render=function(t,i){this.context.save();var s=this.x-t,a=this.y-i;switch(this.name){case e.HEALTHPACK:this.context.beginPath(),this.context.fillStyle="white",this.context.rect(s,a,this.width,this.height),this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.fillStyle="red",this.context.rect(s,a+this.height/2-this.height/8,this.width,this.height/4),this.context.rect(s+this.width/2-this.width/8,a,this.width/4,this.height),this.context.fill(),this.context.closePath();break;case e.DAMAGEBOOST:this.context.beginPath(),this.context.fillStyle="lightgrey",this.context.rect(s,a,this.width,this.height),this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.fillStyle="red",this.context.moveTo(s+this.width/2,a+this.height/4),this.context.lineTo(s+this.width/4,a+this.height/2),this.context.lineTo(s+this.width/1.3,a+this.height/2),this.context.fill(),this.context.moveTo(s+this.width/2,a+this.height/2),this.context.lineTo(s+this.width/4,a+this.height/1.25),this.context.lineTo(s+this.width/1.3,a+this.height/1.25),this.context.fill(),this.context.closePath();break;case e.SPEEDBOOST:this.context.beginPath(),this.context.fillStyle="lightgrey",this.context.rect(s,a,this.width,this.height),this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.fillStyle="limegreen",this.context.moveTo(s,a),this.context.lineTo(s+this.width/2,a+this.height/2),this.context.lineTo(s,a+this.height),this.context.moveTo(s+this.width/2,a),this.context.lineTo(s+this.width,a+this.height/2),this.context.lineTo(s+this.width/2,a+this.height),this.context.fill(),this.context.closePath();break;default:return}this.context.restore()}}var e={HEALTHPACK:"healthpack",DAMAGEBOOST:"damageboost",SPEEDBOOST:"speedboost"};t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.applyEffect=function(t){switch(this.name){case e.HEALTHPACK:var i=t.maxHealth-t.health;25>i?t.health+=i:t.health+=25;break;case e.DAMAGEBOOST:t.equippedWeapon.damage+=5;break;case e.SPEEDBOOST:t.maxSpeed+=.1;break;default:return}},t.random=function(){var i,s=Game.Math.random();return i=.15>s?e.DAMAGEBOOST:s>.25&&.85>s?e.HEALTHPACK:e.SPEEDBOOST,new t({name:i})},Game.Item=t}(),!function(){function t(t){this.init(t),this.projectileLifespan=t.projectileLifespan||1e3,this.damage=t.damage||10,this.fireDelay=t.fireDelay||1,this.projectileSpeed=t.projectileSpeed||10,this.numOfProjectiles=t.numOfProjectiles||1,this.projectileOffX=t.projectileOffX||0,this.projectileOffY=t.projectileOffY||0,this.projectileColor=t.projectileColor||"red",this.delay=0,this.acc=0;var e={color:this.projectileColor,ttl:this.projectileLifespan,projectileSpeed:this.projectileSpeed,offX:this.projectileOffX,offY:this.projectileOffY};this.projectileProperties=e,this.projectileProperties.x=this.x,this.projectileProperties.y=this.y,this.projectile=Game.Projectile}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.fire=function(t){var e=Object.assign({},this.projectileProperties);e.angle=t,e.x=this.x,e.y=this.y,e.damage=this.damage;var i=new this.projectile(e);return i},t.prototype.countDelay=function(){this.delay++},t.prototype.resetFireDelay=function(){this.delay=0},t.prototype.canFire=function(){return this.delay===this.fireDelay||0===this.delay?(this.resetFireDelay(),!0):!1},Game.Weapon=t}(),!function(){function t(t){this.init(t);var e=t.projectileShape||[{x:-2,y:-2},{x:2,y:-2},{x:2,y:2},{x:-2,y:2},{x:-2,y:-2}];t.projectileShape?(this.offX=t.offX,this.offY=t.offY):(this.offX=2,this.offY=2),this.hitBox=new Game.Polygon({x:t.x,y:t.y,points:e}),this.update=function(){this.ttl>0&&(this.hitBox.x=this.x,this.hitBox.y=this.y,this.x+=Game.Math.sin(this.angle)*this.projectileSpeed,this.y+=-Game.Math.cos(this.angle)*this.projectileSpeed,this.ttl-=1)},this.collidesWith=function(t){for(var e=0;e<this.hitBox.points.length;e++)if(t.hitBox.hasPoint(this.hitBox.x+this.hitBox.points[e].x,this.hitBox.y+this.hitBox.points[e].y))return!0;for(var i=0;i<t.hitBox.points.length;i++)if(this.hitBox.hasPoint(t.hitBox.x+t.hitBox.points[i].x,t.hitBox.y+t.hitBox.points[i].y))return!0;return!1},this.render=function(t,e){this.isAlive()&&(this.context.save(),this.context.beginPath(),this.context.fillStyle=this.color,this.context.arc(this.x-t,this.y-e,2,0,2*Math.PI),this.context.closePath(),this.context.fill(),this.context.restore())}}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.rotate=function(t){this.hitBox.rotate(this.angle)},t.prototype.kill=function(){this.ttl=0},Game.Projectile=t}(),!function(){function t(t){this.init(t),this.hitBox=new Game.Polygon({x:t.x,y:t.y,points:t.hitBoxMatrix}),this.rotateSpeed=2,this.rotation=0,this.maxSpeed=5,this.acc=0,this.accSpeed=.1,this.weaponInventory=[e],this.equippedWeapon=e,this.itemInventory=[],this.health=500,this.maxHealth=500,this.isFiring=!1,this.collidesWith=function(t){if(t){for(var e=0;e<this.hitBox.points.length;e++)if(t.hitBox.hasPoint(this.hitBox.x+this.hitBox.points[e].x,this.hitBox.y+this.hitBox.points[e].y))return!0;for(var i=0;i<t.hitBox.points.length;i++)if(this.hitBox.hasPoint(t.hitBox.x+t.hitBox.points[i].x,t.hitBox.y+t.hitBox.points[i].y))return!0;return!1}},this.renderHitBox=function(){this.context.beginPath(),this.context.strokeStyle="red";for(var t=0;t<this.hitBox.points.length;t++)this.context.lineTo(this.hitBox.x+this.hitBox.points[t].x,this.hitBox.y+this.hitBox.points[t].y);this.context.closePath(),this.context.stroke(),this.context.strokeStyle="black"},this.equipWeapon=function(t){this.equippedWeapon=t},this.renderWeapon=function(){this.equippedWeapon.render()},this.update=function(){if(Game.Controls.keys.pressed("left")&&(this.rotation-=this.rotateSpeed,this.hitBox.rotate(-this.rotateSpeed)),Game.Controls.keys.pressed("right")&&(this.rotation+=this.rotateSpeed,this.hitBox.rotate(this.rotateSpeed)),Game.Controls.keys.pressed("up")?(this.acc<this.maxSpeed&&(this.acc+=this.accSpeed),this.x+=Game.Math.sin(this.rotation)*this.acc,this.y+=-Game.Math.cos(this.rotation)*this.acc,this.hitBox.x=this.x,this.hitBox.y=this.y):Game.Controls.keys.pressed("down")?(this.acc>-this.maxSpeed&&(this.acc-=this.accSpeed),this.x+=Game.Math.sin(this.rotation)*this.acc,this.y+=-Game.Math.cos(this.rotation)*this.acc,this.hitBox.x=this.x,this.hitBox.y=this.y):(Math.ceil(this.acc)<0?this.acc+=this.accSpeed:Math.ceil(this.acc)>0?this.acc-=this.accSpeed:this.acc=0,this.x+=Game.Math.sin(this.rotation)*this.acc,this.y+=-Game.Math.cos(this.rotation)*this.acc,this.hitBox.x=this.x,this.hitBox.y=this.y),this.equippedWeapon){var t=Game.Math.cos(this.rotation),e=Game.Math.sin(this.rotation),i=this.equippedWeapon.projectileProperties.offX,s=this.equippedWeapon.projectileProperties.offY,a=this.equippedWeapon.offX+i,h=this.equippedWeapon.offY-s;this.equippedWeapon.x=this.x+(a*t-h*e),this.equippedWeapon.y=this.y+(a*e+h*t)}Game.Controls.keys.pressed("space")?this.equippedWeapon&&(this.isFiring=!0):this.isFiring=!1},this.render=function(t,e){var i=t||0,s=e||0;this.context.save(),this.context.translate(this.x-i,this.y-s),this.context.rotate(Game.Math.rad(this.rotation)),this.equippedWeapon&&this.renderWeapon(),this.context.fillStyle=this.color,this.context.beginPath(),this.context.moveTo(0,-20),this.context.lineTo(25,30),this.context.lineTo(0,this.height/2+5),this.context.lineTo(-25,30),this.context.lineTo(0,-20),this.context.fill(),this.context.stroke(),this.context.beginPath(),this.context.rect(-6,this.height/2.5,5,12.5),this.context.fill(),this.context.stroke(),this.context.beginPath(),this.context.rect(1,this.height/2.5,5,12.5),this.context.fill(),this.context.stroke(),this.context.beginPath(),this.context.rect(-(this.width/2),-(this.height/2),this.width,this.height),this.context.fill(),this.context.stroke(),this.context.beginPath(),this.context.arc(0,-(this.height/2),10,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.beginPath(),this.context.fillStyle="black",this.context.arc(0,-(this.height/2)-2.5,5,Math.PI,2*Math.PI),this.context.fill(),this.context.restore()}}var e=new Game.Weapon({offX:-2.5,offY:-30,width:5,height:10,color:"white",fireDelay:10,projectileOffX:2,projectileOffY:2,damage:20,render:function(){this.context.save(),this.context.fillStyle=this.color,this.context.beginPath(),this.context.rect(this.offX,this.offY,5,10),this.context.fill(),this.context.stroke(),this.context.restore()}});t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.canPickup=function(t){var e=Game.Math.distance(this,t);return e<t.pickupRadius?"healthpack"===t.name?this.health!==this.maxHealth?!0:!1:!0:!1},t.prototype.pickupItem=function(t){t.applyEffect(this)},t.prototype.canLandOn=function(t){var e=Game.Math.distance(this,t);return e<t.landingRadius?!0:!1},t.prototype.shoot=function(){return this.equippedWeapon.fire(this.rotation)},t.prototype.updateHitBoxRotation=function(t){"left"===t?this.hitBox.rotate(-this.rotateSpeed*Math.PI/180):"right"===t&&this.hitBox.rotate(this.rotateSpeed*Math.PI/180)},t.prototype.takeDamage=function(t){this.health-=t},t.prototype.isDead=function(){return this.health<=0?!0:!1},t.prototype.stop=function(){this.acc=0},Game.PlayerShip=new t({x:kontra.canvas.width/2,y:kontra.canvas.height/2,width:15,height:30,color:"white",hitBoxMatrix:[{x:-12,y:-25},{x:12,y:-25},{x:25,y:30},{x:-25,y:30},{x:-12,y:-25}]})}(),!function(){function t(t){this.init(t),this.direction=0,this.health=this.health||Math.floor(Game.Math.random(25,150)),this.weapon=new Game.Weapon({damage:Math.floor(Game.Math.random(15,25)),projectileSpeed:Math.floor(Game.Math.random(10,15))}),this.isFiring=!1,this.lastFire=0,this.fireInt=Game.Math.random(500,1500),this.detectionRadius=this.detectionRadius||Math.floor(Game.Math.random(300,500)),this.movementSpeed=this.movementSpeed||Math.floor(Game.Math.random(1,4))}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.shootAt=function(t){var e=Game.Math.angleFrom(this,t)+90;return this.weapon.fire(e)},t.prototype.attack=function(t){var e=Game.Math.distance(this,t),i=Game.Math.angleFrom(this,t),s=e*Game.Math.cos(i+90),a=e*Game.Math.sin(i+90);e<this.detectionRadius&&e>200&&(this.x-=s/this.movementSpeed,this.y-=a/this.movementSpeed)},t.prototype.moveTo=function(t,e,i){Game.Animator.animateTo(this,t,e,i)},t.prototype.takeDamage=function(t){this.health-=t},t.prototype.isDead=function(){return this.health<=0?!0:!1},t.prototype.dropItem=function(){var t=Game.Item.random();return t.x=this.x,t.y=this.y,Game.Math.random()>Game.Math.random()?t:!1},Game.Enemy=t}(),!function(){function t(t){Game.Enemy.call(this,t),this.radius=Math.floor(Game.Math.random(20,30)),this.innerColor="rgb("+Math.floor(Game.Math.random(256))+", "+Math.floor(Game.Math.random(256))+", "+Math.floor(Game.Math.random(256))+")",this.outerColor="rgb("+Math.floor(Game.Math.random(256))+", "+Math.floor(Game.Math.random(256))+", "+Math.floor(Game.Math.random(256))+")",this.isFollowing=!1,this.direction=Game.Math.random(-360,360),this.directionUpdateInt=Game.Math.random(1e3,4e3),this.lastDirectionUpdate=0,this.update=function(){var t=performance.now();this.following&&(this.isFollowing=!0,this.direction=Game.Math.angleFrom(this,this.following)+90),this.isFollowing||t-this.lastDirectionUpdate>this.directionUpdateInt&&(this.direction+=Game.Math.random(-90,90),this.lastDirectionUpdate=t,this.directionUpdateInt=Game.Math.random(500,1500)),this.isFollowing&&Game.Math.distance(this,this.following)>100&&(this.x+=Game.Math.sin(this.direction)*this.movementSpeed,this.y+=-Game.Math.cos(this.direction)*this.movementSpeed),t-this.lastFire>this.fireInt?(this.isFiring=!0,this.lastFire=t,this.fireInt=Game.Math.random(1e3,2e3)):this.isFiring=!1,this.weapon.x=this.x,this.weapon.y=this.y},this.render=function(t,e){var t=t||0,e=e||0;this.context.save(),this.context.beginPath(),this.context.fillStyle=this.outerColor,this.context.arc(this.x-t,this.y-e,this.radius,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.beginPath(),this.context.fillStyle=this.innerColor,this.context.arc(this.x-t,this.y-e,this.radius/2,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.restore()}}t.prototype=Object.create(Game.Enemy.prototype),t.prototype.follow=function(t){this.following=t},t.prototype.isHitBy=function(t){var e=Game.Math.distance(this,t);return e<this.radius?!0:!1},Game.EnemyShip=t}(),!function(){function t(t){this.init(t),this.radius=t.radius||Game.Math.random(10,60);var e=t.hitBoxMatrix||t.points||this.generateRandomHitBoxMatrix();this.hitBox=new Game.Polygon({x:t.x,y:t.y,points:e}),this.rotationSpeed=Game.Math.random(-2,2),this.direction=Game.Math.random(-360,360),this.speed=t.speed||Game.Math.random(5);var i=t.maxHealth||this.radius*Game.Math.random(2,10);this.maxHealth=i,this.health=i,this.numberOfSplits=Math.floor(this.radius/20),this.damage=this.radius,this.update=function(){this.hitBox.rotate(this.rotationSpeed),this.hitBox.x+=Game.Math.sin(this.direction)*this.speed,this.hitBox.y+=Game.Math.cos(this.direction)*this.speed},this.render=function(t,e){this.context.save(),this.context.beginPath(),this.context.strokeStyle="#d6d6d6";for(var i=0;i<this.hitBox.points.length;i++)this.context.lineTo(this.hitBox.x+this.hitBox.points[i].x-t,this.hitBox.y+this.hitBox.points[i].y-e);this.context.closePath(),this.context.fillStyle="#272727",this.context.fill(),this.context.stroke(),this.context.restore()}}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.contructor=t,t.prototype.scale=function(t){this.radius*=t,this.health*=t,this.hitBox.scale(t)},t.prototype.takeDamage=function(t){this.health-=t},t.prototype.destroyed=function(){return this.health<=0?!0:!1},t.prototype.canSplit=function(){return this.numberOfSplits>1?!0:!1},t.prototype.generateRandomHitBoxMatrix=function(t){for(var e=this.numOfPoints||Math.floor(Game.Math.random(7,16)),i=[],s=0,a=360/e,h=0;e>h;h++){var n={},o=this.radius-Math.floor(Game.Math.random(-this.radius/2,this.radius/2));n.x=Game.Math.cos(s)*o,n.y=Game.Math.sin(s)*o,i.push(n),s+=a}return i},t.prototype.dropItem=function(){var t=Game.Item.random();return t.x=this.hitBox.x,t.y=this.hitBox.y,Game.Math.random()>Game.Math.random()?t:!1},Game.Asteroid=t}(),!function(){function t(t){this.init(t),this.name="PlanetName1",this.radius=t.radius||Game.Math.random(200,600),this.landingRadius=this.radius+50,this.stage=this.generatePlanetStage(),this.update=function(){},this.render=function(t,e){this.context.save(),this.context.beginPath(),this.context.strokeStyle="#d6d6d6",this.context.arc(this.x-t,this.y-e,this.radius,0,2*Math.PI),this.context.closePath(),this.context.fillStyle="#272727",this.context.fill(),this.context.stroke(),this.context.restore()}}t.prototype=Object.create(kontra.sprite.prototype),t.prototype.constructor=t,t.prototype.generatePlanetStage=function(){var t=new Game.PlanetStage(this.name,{});return t},Game.Planet=t}(),!function(){function t(t,e){Game.State.call(this,t,e),this.gravity=this.gravity||9.8,this.foregroundColor=this.foreGroundColor||"#d6d6d6",this.backgroundColor=this.backgroundColor||"#bababa",this.player=Game.Player,this.playerBullets=[],this.enemies=[],this.enemyBullets=[],this.camera=new Game.Camera(kontra.canvas.width/2,kontra.canvas.height/2,kontra.canvas.width,kontra.canvas.height),this.camera.follow(this.player,kontra.canvas.width/2,kontra.canvas.height/2)}t.prototype=Object.create(Game.State.prototype),t.prototype.constructor=t,t.prototype.update=function(){},t.prototype.render=function(){for(var t=0;t<this.enemyBullets.length;t++)this.enemyBullets[t].render(this.camera.xView,this.camera.yView);for(var e=0;e<this.playerBullets.length;e++)this.playerBullets[e].render(this.camera.xView,this.camera.yView);for(var i=0;i<this.enemies.length;i++)this.enemies[i].render(this.camera.xView,this.camera.yView);this.player.render(this.camera.xView,this.camera.yView)},Game.PlanetStage=t}(),Game.StateManager.state("Space",{init:function(){Game.Store.enemiesKilled=0,Game.Store.asteroidsDestroyed=0,Game.Store.itemsPickedup=0,Game.Store.survived=0,this.spawnRadiusMin=kontra.canvas.width+kontra.canvas.height-kontra.canvas.height/4,this.spawnRadiusMax=kontra.canvas.width+kontra.canvas.height,this.spawnObjects={asteroid:{lastSpawn:0,minSpawnInt:5,maxSpawnInt:10,spawnInt:this.generateSpawnDelay(5,10)},planet:{lastSpawn:0,minSpawnInt:30,maxSpawnInt:60,spawnInt:this.generateSpawnDelay(30,60)},enemy:{lastSpawn:0,minSpawnInt:5,maxSpawnInt:20,spawnInt:this.generateSpawnDelay(5,20)},item:{lastSpawn:0,minSpawnInt:30,maxSpawnInt:45,spawnInt:this.generateSpawnDelay(30,45)}},this.enemyShips=[],this.asteroids=[],this.planets=[],this.playerShip=Game.PlayerShip,this.playerShipHealthGraphic=new Game.Graphic({x:10,y:10,isFixed:!1,data:{playerHealth:this.playerShip.health,maxPlayerHealth:this.playerShip.maxHealth},updateHealthBar:function(t){this.data.playerHealth=t,this.data.playerHealth<=0&&(this.data.playerHealth=0)},drawFunc:function(){this.context.save(),this.context.fillStyle="red",this.context.fillRect(this.x,this.y,200*(this.data.playerHealth/this.data.maxPlayerHealth),10),
this.context.restore()}}),this.graphics.add(this.playerShipHealthGraphic),this.items=[],this.playerBullets=[],this.enemyBullets=[],this.camera=new Game.Camera(kontra.canvas.width/2,kontra.canvas.height/2,kontra.canvas.width,kontra.canvas.height),this.camera.follow(this.playerShip,kontra.canvas.width/2,kontra.canvas.height/2);for(var t=[],e=200,i=0;e>i;i++){var s={};s.x=Game.Math.random(kontra.canvas.width),s.y=Game.Math.random(kontra.canvas.height),s.radius=Game.Math.random(1.2),t.push(s)}this.stars=kontra.sprite({starVectors:t,update:function(t,e){for(var i=0;i<this.starVectors.length;i++)this.starVectors[i].x>t+kontra.canvas.width?this.starVectors[i].x=t:this.starVectors[i].x<t&&(this.starVectors[i].x=t+kontra.canvas.width),this.starVectors[i].y>e+kontra.canvas.height?this.starVectors[i].y=e:this.starVectors[i].y<e&&(this.starVectors[i].y=e+kontra.canvas.height)},render:function(t,e){this.context.save(),this.context.fillStyle="white";for(var i=0;i<this.starVectors.length;i++)this.context.beginPath(),this.context.arc(this.starVectors[i].x-t,this.starVectors[i].y-e,this.starVectors[i].radius,0,2*Math.PI),this.context.fill(),this.context.closePath();this.context.restore()}})},update:function(){this.camera.update(),this.stars.update(this.camera.xView,this.camera.yView);for(var t=0;t<this.planets.length;t++)this.planets[t].update(),this.playerShip.canLandOn(this.planets[t]);for(var e=0;e<this.playerBullets.length;e++)this.playerBullets[e].update(),this.playerBullets[e].isAlive()||(this.playerBullets.splice(e,1),e--);for(var i=0;i<this.items.length;i++)this.items[i].update(),this.playerShip.canPickup(this.items[i])&&(this.playerShip.pickupItem(this.items[i]),Game.Store.itemsPickedup++,this.playerShipHealthGraphic.updateHealthBar(this.playerShip.health),this.items.splice(i,1),i--);for(var s=0;s<this.asteroids.length;s++){if(this.asteroids[s].update(),this.playerBullets.length)for(var a=0;a<this.playerBullets.length;a++)this.playerBullets[a].collidesWith(this.asteroids[s])&&(this.asteroids[s].takeDamage(this.playerBullets[a].damage),this.playerBullets[a].kill());if(this.asteroids[s].destroyed()){if(this.asteroids[s].canSplit()){for(var h=0;h<this.asteroids[s].numberOfSplits;h++){var n=Object.assign({},this.asteroids[s]),o=new Game.Asteroid(n);o.hitBox.x=this.asteroids[s].hitBox.x,o.hitBox.y=this.asteroids[s].hitBox.y,o.scale(1/this.asteroids[s].numberOfSplits),this.asteroids.push(o)}var r=this.asteroids[s].dropItem();r&&this.items.push(r),this.asteroids.splice(s,1)}else{var r=this.asteroids[s].dropItem();r&&this.items.push(r),this.asteroids.splice(s,1),s--}Game.Store.asteroidsDestroyed++}if(this.playerShip.collidesWith(this.asteroids[s])){this.playerShip.takeDamage(this.asteroids[s].damage),this.asteroids[s].takeDamage(50);var c=Game.Math.angleFrom(this.playerShip,this.asteroids[s].hitBox)+180,p=Game.Math.cos(c),l=Game.Math.sin(c);this.playerShip.stop(),Game.Animator.animateTo(this.playerShip,this.asteroids[s].damage*p,this.asteroids[s].damage*l,100),this.playerShipHealthGraphic.updateHealthBar(this.playerShip.health)}}for(var d=0;d<this.enemyShips.length;d++){if(this.enemyShips[d].update(),Game.Math.distance(this.enemyShips[d],this.playerShip)<this.enemyShips[d].detectionRadius&&(this.enemyShips[d].follow(this.playerShip),this.enemyShips[d].isFiring)){var x=this.enemyShips[d].shootAt(this.playerShip);this.enemyBullets.push(x)}if(this.playerBullets.length)for(var e=0;e<this.playerBullets.length;e++)this.enemyShips[d].isHitBy(this.playerBullets[e])&&(this.enemyShips[d].takeDamage(this.playerBullets[e].damage),this.playerBullets[e].kill());if(this.enemyShips[d].isDead()){Game.Store.enemiesKilled++;var r=this.enemyShips[d].dropItem();r&&this.items.push(r),this.enemyShips.splice(d,1),d--}}for(var u=0;u<this.enemyBullets.length;u++)this.enemyBullets[u].update(),this.enemyBullets[u].collidesWith(this.playerShip)&&(this.playerShip.takeDamage(this.enemyBullets[u].damage),this.enemyBullets[u].kill(),this.playerShipHealthGraphic.updateHealthBar(this.playerShip.health)),this.enemyBullets[u].isAlive()||(this.enemyBullets.splice(u,1),u--);if(this.playerShip.update(),this.playerShip.isFiring)if(this.playerShip.equippedWeapon.canFire()){var y=this.playerShip.shoot();this.playerBullets.push(y),this.playerShip.equippedWeapon.countDelay()}else this.playerShip.equippedWeapon.countDelay();else this.playerShip.equippedWeapon.resetFireDelay();this.playerShip.isDead()&&(Game.Store.survived=Math.floor(performance.now()),Game.StateManager.setCurrentState("GameOver"));var m=performance.now();for(spawnable in this.spawnObjects)m-this.spawnObjects[spawnable].lastSpawn>=this.spawnObjects[spawnable].spawnInt&&(this.spawn(spawnable),this.spawnObjects[spawnable].lastSpawn=m,this.spawnObjects[spawnable].spawnInt=this.generateSpawnDelay(this.spawnObjects[spawnable].minSpawnInt,this.spawnObjects[spawnable].maxSpawnInt))},render:function(){this.stars.render(this.camera.xView,this.camera.yView);for(var t=0;t<this.planets.length;t++)this.planets[t].render(this.camera.xView,this.camera.yView);for(var e=0;e<this.playerBullets.length;e++)this.playerBullets[e].render(this.camera.xView,this.camera.yView);for(var i=0;i<this.enemyBullets.length;i++)this.enemyBullets[i].render(this.camera.xView,this.camera.yView);for(var s=0;s<this.asteroids.length;s++)this.asteroids[s].render(this.camera.xView,this.camera.yView);for(var a=0;a<this.enemyShips.length;a++)this.enemyShips[a].render(this.camera.xView,this.camera.yView);for(var h=0;h<this.items.length;h++)this.items[h].render(this.camera.xView,this.camera.yView);this.playerShip.render(this.camera.xView,this.camera.yView)},addAsteroid:function(){for(var t=Math.floor(Game.Math.random(1,5)),e=0;t>e;e++){var i=this.generateSpawnVector(),s=new Game.Asteroid({x:i.x,y:i.y});this.asteroids.push(s)}},addEnemy:function(){var t=this.generateSpawnVector(),e=new Game.EnemyShip({x:t.x,y:t.y});this.enemyShips.push(e)},addPlanet:function(){var t=this.generateSpawnVector(),e=new Game.Planet({x:t.x,y:t.y}),i=!1;if(this.planets.length)for(var s=0;s<this.planets.length;s++){if(Game.Math.distance(e,this.planets[s])<3*this.planets[s].radius){i=!1;break}i=!0}else i=!0;i&&this.planets.push(e)},addItem:function(){var t=this.generateSpawnVector(),e=Game.Item.random();e.x=t.x,e.y=t.y,this.items.push(e)},spawn:function(t){switch(t){case"asteroid":this.addAsteroid();break;case"planet":this.addPlanet();break;case"enemy":this.addEnemy();break;case"item":this.addItem()}},generateSpawnVector:function(){var t={},e=Game.Math.random(-360,360),i=Game.Math.random(this.spawnRadiusMin,this.spawnRadiusMax);return t.x=this.camera.xView+Game.Math.cos(e)*i,t.y=this.camera.yView+Game.Math.sin(e)*i,t},generateSpawnDelay:function(t,e){return Game.Math.random(1e3*t,1e3*e)}}),Game.StateManager.state("GameOver",{update:function(){},render:function(){var t=kontra.canvas.width/2,e=kontra.canvas.height/2-100;this.text.add({x:t,y:e-60,px:"25px",textAlign:"center",text:"Game Over!"}),this.text.add({x:t,y:e-30,px:"25px",textAlign:"center",text:"Thanks for Playing!"});for(scoreName in Game.Store)"survived"!=scoreName?this.text.add({x:t,y:e+=30,px:"20px",textAlign:"center",text:scoreName.toUpperCase()+": "+Game.Store[scoreName]}):this.text.add({x:t,y:e+=30,px:"20px",textAlign:"center",text:scoreName.toUpperCase()+": "+Math.floor(Game.Store[scoreName]/1e3)+" seconds"})}}),Game.StateManager.state("Intro",{init:function(){var t=kontra.canvas.width/2,e=kontra.canvas.height/2,i=t,s=e-50,a="20px",h="center";this.text.add({x:i,y:s,px:a,textAlign:h,text:"You were once a space pilot, who was performing a"}),this.text.add({x:i,y:s+=35,px:a,textAlign:h,text:"routine exploration mission near the edge"}),this.text.add({x:i,y:s+=35,px:a,textAlign:h,text:"of the Milky Way when suddenly, you were sucked into a wormhole "}),this.text.add({x:i,y:s+=35,px:a,textAlign:h,text:"and displaced to an unknown location in the universe."}),this.text.add({x:i,y:s+=35,px:a,textAlign:h,text:"This is your story."}),this.text.add({x:i,y:2*e-30,px:a,textAlign:h,text:"Press (enter) to start."})},update:function(){Game.Controls.keys.tapped("enter")&&Game.StateManager.setCurrentState("Space")},render:function(){}}),Game.StateManager.setCurrentState("Intro");var GameLoop=Game.gameLoop({update:function(){Game.StateManager.updateCurrentState()},render:function(){kontra.context.fillStyle="#272727",kontra.context.fillRect(0,0,kontra.canvas.width,kontra.canvas.height),Game.StateManager.renderCurrentState()}});GameLoop.start();